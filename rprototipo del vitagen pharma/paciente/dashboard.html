<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Paciente - Pharma Vitagen</title>
    <link rel="stylesheet" href="../styles.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="patient-header" style="background-color: var(--color-bloque-b);">
        <a href="../index.html" class="logo-link">
             <img src="../src/logo.jpg" alt="Logo Pharma Vitagen" class="logo-img">
             <h1 style="color: white;"><i class="fas fa-user"></i> PHARMA VITAGEN</h1>
        </a>
    </div>

    <div class="content-page admin-panel-content">
        <h2>Mi Portal de Paciente</h2>
        
        <p style="text-align: center; color: #6c757d; margin-bottom: 30px;">
            Bienvenido(a), <span id="nombre-paciente-display">[Nombre del Paciente]</span>. Aquí puedes gestionar tu salud.
        </p>

        <h3>Tu Próxima Cita</h3>
        
        <div id="cita-titulo" style="text-align: center; margin-bottom: 15px; font-weight: bold;">
        </div>
        
        <div class="summary-cards">
            <div id="cita-detalle" class="card" style="background-color: var(--color-principal); color: white; padding: 25px; display: none;">
                <p style="font-size: 1.1em; margin-bottom: 10px;">**Especialidad:** <span id="cita-especialidad"></span></p>
                <p style="font-size: 1.1em; margin-bottom: 10px;">**Doctor(a):** <span id="cita-doctor"></span></p>
                <p style="font-size: 1.1em;">**Fecha/Hora:** <span id="cita-fecha-hora"></span></p>
            </div>
        </div>
        
        <h3>Opciones Rápidas</h3>
        <ul class="admin-menu" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
            <li>
                <a href="../agendar_cita.html">
                    <i class="fas fa-calendar-plus"></i> Agendar Nueva Cita
                </a>
            </li>
            <li>
                <a href="../historial_medico.html">
                    <i class="fas fa-history"></i> Historial Médico Completo
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-file-invoice"></i> Resultados de Laboratorio
                </a>
            </li>
            <li>
                <a href="../carrito.html">
                    <i class="fas fa-shopping-cart"></i> Farmacia Online
                </a>
            </li>
        </ul>

        <a href="#" class="btn-form-submit btn-logout" style="width: 300px; margin: 40px auto 20px auto; background-color: var(--color-bloque-a);">
            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </a>
    </div>

    <footer>
        <p>&copy; 2025 Pharma Vitagen. Derechos Reservados.</p>
    </footer>
    
    <div class="chatbot-bubble" id="chatbot-bubble">
        <i class="fas fa-comment-alt"></i>
    </div>
    <div class="chatbot-window" id="chatbot-window">
        <div class="chatbot-header">Asistente Virtual</div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message">¡Hola! 👋 Soy tu asistente virtual. Pregunta por "cita", "farmacia" o "ayuda".</div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input-text" placeholder="Escribe tu mensaje...">
            <button id="chatbot-send"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        function loadPatientDashboard() {
            const currentUserData = localStorage.getItem('currentUser');
            const nombreDisplay = document.getElementById('nombre-paciente-display');

            if (!currentUserData) {
                // Si no hay sesión, regresa al login
                window.location.href = '../login.html'; 
                return;
            }

            const user = JSON.parse(currentUserData);
            
            if (user && user.nombre && nombreDisplay) {
                nombreDisplay.textContent = user.nombre; 
            } else {
                nombreDisplay.textContent = 'Paciente';
            }
        }

        function cargarCita() {
            const currentUserData = localStorage.getItem('currentUser');
            if (!currentUserData) return;

            const user = JSON.parse(currentUserData);
            const cita = user.proximaCita; // Lee la cita específica de este usuario
            
            const citaDetalle = document.getElementById('cita-detalle');
            const citaTitulo = document.getElementById('cita-titulo');

            if (cita) {
                // Muestra y llena la información de la cita guardada
                document.getElementById('cita-especialidad').textContent = cita.especialidad;
                document.getElementById('cita-doctor').textContent = cita.doctor;
                document.getElementById('cita-fecha-hora').textContent = `${cita.fecha}, ${cita.hora}`;

                citaDetalle.style.display = 'block';
                citaTitulo.textContent = 'Tienes una cita programada:';
                citaTitulo.style.color = 'var(--color-principal)';
            } else {
                // Muestra el mensaje de sin citas para este usuario
                citaDetalle.style.display = 'none';
                citaTitulo.textContent = 'Actualmente no tienes citas programadas.';
                citaTitulo.style.color = '#6c757d';
            }
        }

        function cerrarSesion() {
            // Elimina la sesión actual
            localStorage.removeItem('currentUser');
            window.location.href = '../login.html';
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadPatientDashboard();
            cargarCita(); 
            
            document.querySelector('.btn-logout').addEventListener('click', function(event) {
                event.preventDefault(); 
                cerrarSesion();
            });
        });
    </script>
    
    <script src="../chatbot.js"></script>
</body>
</html>